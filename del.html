<!DOCTYPE html>
<html lang="bn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ডেটা এন্ট্রি ফর্ম - আবিদ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Hind Siliguri", sans-serif;
        background: linear-gradient(135deg, #f0f4f8, #e0e8f0);
      }
      .container-bg {
        background: #ffffff;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: box-shadow 0.3s ease;
      }
      .container-bg:hover {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }
      .button-gradient {
        background: linear-gradient(90deg, #3b82f6, #60a5fa);
        transition: all 0.3s ease;
      }
      .button-gradient:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(59, 130, 246, 0.3);
      }
      .message-box {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background-color: #fff;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        display: none;
        text-align: center;
        font-weight: 600;
      }
      .message-box.show {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translate(-50%, -10px);
        }
        to {
          opacity: 1;
          transform: translate(-50%, 0);
        }
      }
      .message-box-error {
        border: 2px solid #ef4444;
        color: #ef4444;
      }
      .message-box-success {
        border: 2px solid #3b82f6;
        color: #3b82f6;
      }
      .report-content {
        max-height: 400px;
        overflow-y: auto;
      }
      .scroll-container::-webkit-scrollbar {
        width: 8px;
      }
      .scroll-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      .scroll-container::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      .scroll-container::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      .table-row-modern {
        transition: all 0.2s ease-in-out;
      }
      .table-row-modern:hover {
        background-color: #f3f4f6;
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #fff;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      input,
      select {
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }
      input:focus,
      select:focus {
        outline: none;
        border-color: #60a5fa;
        box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
      }
    </style>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div
      class="container-bg rounded-2xl shadow-2xl p-6 md:p-10 w-full max-w-md space-y-8"
    >
      <h1
        class="text-3xl font-bold text-center text-gray-800 flex items-center justify-center space-x-2"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="36"
          height="36"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-file-text text-blue-500"
        >
          <path
            d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
          />
          <polyline points="14 2 14 8 20 8" />
          <line x1="16" x2="8" y1="13" y2="13" />
          <line x1="16" x2="8" y1="17" y2="17" />
          <line x1="10" x2="8" y1="9" y2="9" />
        </svg>
        <span>মিল এন্ট্রি ফর্ম</span>
      </h1>
      <h2
        id="yearName"
        class="text-xl text-center text-gray-500 font-semibold italic"
      ></h2>
      <form id="dataEntryForm" class="space-y-6">
        <!-- Name Selection Section -->
        <div class="space-y-2">
          <label for="name" class="block text-gray-700 font-medium"
            >নাম নির্বাচন করুন</label
          >
          <select
            id="name"
            name="name"
            required
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
          >
            <option value="" disabled selected>আপনার নাম বেছে নিন</option>
          </select>
        </div>
        <!-- Meal Selection Section Grouped in a Card -->
        <div class="bg-gray-50 p-6 rounded-lg shadow-inner space-y-4">
          <h3 class="text-lg font-bold text-center text-gray-800">
            খাবার নির্বাচন
          </h3>
          <div class="space-y-2">
            <label for="mealOptions" class="block text-gray-700 font-medium"
              >আজকের খাবার</label
            >
            <select
              id="mealOptions"
              name="meal"
              required
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
            >
              <option value="" disabled selected>খাবার বেছে নিন</option>
            </select>
          </div>
          <div class="space-y-2">
            <label
              for="nextDayMealOptions"
              class="block text-gray-700 font-medium"
              >পরের দিনের খাবার</label
            >
            <select
              id="nextDayMealOptions"
              name="nextDay"
              required
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
            >
              <option value="" disabled selected>খাবার বেছে নিন</option>
            </select>
          </div>
        </div>
        <!-- Submit Button with enhanced design -->
        <button
          type="submit"
          id="submitBtn"
          class="w-full text-white font-semibold py-3 px-4 rounded-lg shadow-lg bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-indigo-600 hover:to-blue-500 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center justify-center space-x-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-save"
          >
            <path
              d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
            />
            <polyline points="17 21 17 13 7 13 7 21" />
            <polyline points="7 3 7 8 15 8" />
          </svg>

          <span>জমা দিন</span>
          <span class="spinner-container hidden">
            <div class="spinner"></div>
          </span>
        </button>
      </form>
      <!-- Start of the new report section -->
      <div class="mt-8 p-6 rounded-2xl shadow-lg bg-gray-100 space-y-6">
        <h2
          class="text-2xl font-bold text-center text-gray-800 border-b-2 border-gray-300 pb-2"
        >
          রিপোর্ট সেকশন
        </h2>
        <div class="flex flex-col gap-4">
          <button
            id="todayReportBtn"
            class="w-full text-white font-semibold py-3 px-4 rounded-lg shadow-md bg-blue-500 hover:bg-blue-600 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center justify-center space-x-2"
          >
            <span class="button-text">আজকের এন্ট্রি দেখুন</span>
            <span class="spinner-container hidden">
              <div class="spinner"></div>
            </span>
          </button>
          <!-- Today's Report Display Area -->
          <div
            id="todayReportContainer"
            class="p-4 bg-gray-50 rounded-lg shadow-inner hidden"
          >
            <h3 class="text-xl font-semibold mb-4 text-gray-800 text-center">
              আজকের এন্ট্রি
            </h3>
            <div
              id="todayReportContent"
              class="report-content scroll-container"
            >
              <!-- Today's data will be displayed here -->
            </div>
          </div>
        </div>
        <div class="flex flex-col gap-4">
          <button
            id="mealReportBtn"
            class="w-full text-white font-semibold py-3 px-4 rounded-lg shadow-md bg-purple-500 hover:bg-purple-600 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 flex items-center justify-center space-x-2"
          >
            <span class="button-text">খাবারের রিপোর্ট দেখুন</span>
            <span class="spinner-container hidden">
              <div class="spinner"></div>
            </span>
          </button>
          <!-- Meal Report Display Area -->
          <div
            id="mealReportContainer"
            class="p-4 bg-gray-50 rounded-lg shadow-inner hidden"
          >
            <h3 class="text-xl font-semibold mb-4 text-gray-800 text-center">
              খাবারের রিপোর্ট
            </h3>
            <div id="mealReportContent" class="report-content scroll-container">
              <!-- Meal report data will be displayed here -->
            </div>
          </div>
        </div>
      </div>
      <!-- End of the new report section -->
      <!-- Manager Info Container -->
      <div
        class="mt-8 p-6 bg-gradient-to-r from-blue-100 to-green-100 rounded-lg shadow-inner text-center"
      >
        <h3 class="text-xl font-bold text-gray-700">ম্যানেজারের তথ্য</h3>
        <div class="mt-2 space-y-1">
          <p class="text-gray-600 flex items-center justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-user-check mr-2 text-blue-500"
            >
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <polyline points="16 11 18 13 22 9" />
            </svg>
            <span>নাম: আবিদ আল জামী</span>
          </p>
          <p class="text-gray-600 flex items-center justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-phone-call mr-2 text-green-500"
            >
              <path
                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
              />
              <path d="M14.5 9.5a4 4 0 0 1 0 5" />
              <path d="M16.5 7.5a8 8 0 0 1 0 9" />
            </svg>
            <span>+88019 2555 6787</span>
          </p>
        </div>
      </div>
      <!-- Notice Box -->
      <div
        class="mt-8 p-6 bg-yellow-50 rounded-lg border-2 border-yellow-300 text-center"
      >
        <h4 class="text-lg font-bold text-gray-800">নোটিশ</h4>
        <p id="noticeText" class="text-gray-700 mt-2"></p>
      </div>
    </div>
    <!-- Message Box -->
    <div id="messageBox" class="message-box">
      <p id="messageText"></p>
    </div>
    <script>
      // NOTE: You MUST replace this URL with your deployed Google Apps Script Web App URL
      const SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbwJAB0nYvn7SgjguMRO6W9MpzyEfZPqefEV8VcRD_mabVvmJbp0FmvdGiWQyUR05YWEVQ/exec";
      const form = document.getElementById("dataEntryForm");
      const submitBtn = document.getElementById("submitBtn");
      const todayReportBtn = document.getElementById("todayReportBtn");
      const mealReportBtn = document.getElementById("mealReportBtn");
      const todayReportContainer = document.getElementById(
        "todayReportContainer"
      );
      const todayReportContent = document.getElementById("todayReportContent");
      const mealReportContainer = document.getElementById(
        "mealReportContainer"
      );
      const mealReportContent = document.getElementById("mealReportContent");
      const messageBox = document.getElementById("messageBox");
      const messageText = document.getElementById("messageText");
      const nameSelect = document.getElementById("name");
      const mealOptionsSelect = document.getElementById("mealOptions");
      const nextDayMealOptionsSelect =
        document.getElementById("nextDayMealOptions");
      const yearNameElement = document.getElementById("yearName");
      const noticeTextElement = document.getElementById("noticeText");
      // Function to show a message
      function showMessage(text, isError = false) {
        messageText.textContent = text;
        messageBox.className =
          "message-box show " +
          (isError ? "message-box-error" : "message-box-success");
        setTimeout(() => {
          messageBox.classList.remove("show");
        }, 3000);
      }
      // Function to set loading state for buttons
      function setButtonLoadingState(button, isLoading) {
        const buttonText = button.querySelector(".button-text");
        const spinnerContainer = button.querySelector(".spinner-container");
        if (buttonText) {
          buttonText.classList.toggle("hidden", isLoading);
        }
        spinnerContainer.classList.toggle("hidden", !isLoading);
        button.disabled = isLoading;
      }
      // Function to load initial data (names, meal options, year, and notice)
      async function loadInitialData() {
        try {
          const response = await fetch(`${SCRIPT_URL}?action=getInitialData`);
          const result = await response.json();
          console.log("Initial Data Response:", result); // For debugging
          if (result.status === "success") {
            // Populate names dropdown
            nameSelect.innerHTML =
              '<option value="" disabled selected>আপনার নাম বেছে নিন</option>';
            if (result.names) {
              result.names.forEach((name) => {
                const option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                nameSelect.appendChild(option);
              });
            }
            // Populate today's meal dropdown
            mealOptionsSelect.innerHTML =
              '<option value="" disabled selected>খাবার বেছে নিন</option>';
            if (result.meals) {
              result.meals.forEach((meal) => {
                const option = document.createElement("option");
                option.value = meal;
                option.textContent = meal;
                mealOptionsSelect.appendChild(option);
              });
            }
            // Populate next day's meal dropdown
            nextDayMealOptionsSelect.innerHTML =
              '<option value="" disabled selected>খাবার বেছে নিন</option>';
            if (result.nextDayMeals) {
              result.nextDayMeals.forEach((meal) => {
                const option = document.createElement("option");
                option.value = meal;
                option.textContent = meal;
                nextDayMealOptionsSelect.appendChild(option);
              });
            }

            // Populate year and notice text
            if (result.yearName) {
              yearNameElement.textContent = result.yearName;
            }
            if (result.noticeText) {
              noticeTextElement.textContent = result.noticeText;
            }
          } else {
            showMessage(
              "কনফিগারেশন ডেটা লোড করতে ব্যর্থ। অনুগ্রহ করে শীটটি পরীক্ষা করুন।",
              true
            );
            console.error("Initial data loading failed:", result.message);
          }
        } catch (error) {
          showMessage(
            "একটি ত্রুটি ঘটেছে। দয়া করে ইন্টারনেট সংযোগ পরীক্ষা করুন।",
            true
          );
          console.error("Error during initial data loading:", error);
        }
      }
      // Load data on page load
      document.addEventListener("DOMContentLoaded", () => {
        loadInitialData();
      });
      // Form submission handler
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        setButtonLoadingState(submitBtn, true);
        showMessage("তথ্য জমা দেওয়া হচ্ছে...", false);
        const formData = new FormData(form);
        const data = {};
        for (let [key, value] of formData.entries()) {
          data[key] = value;
        }
        try {
          const response = await fetch(SCRIPT_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams(data).toString(),
          });
          const result = await response.json();
          console.log("Submission Response:", result); // For debugging
          if (result.status === "success") {
            showMessage("তথ্য সফলভাবে জমা হয়েছে!", false);
            form.reset();
            await loadInitialData();
          } else {
            showMessage(
              "তথ্য জমা দিতে ব্যর্থ। অনুগ্রহ করে আবার চেষ্টা করুন।",
              true
            );
            console.error("Submission failed:", result.message);
          }
        } catch (error) {
          showMessage(
            "একটি ত্রুটি ঘটেছে। দয়া করে ইন্টারনেট সংযোগ পরীক্ষা করুন।",
            true
          );
          console.error("Error during submission:", error);
        } finally {
          setButtonLoadingState(submitBtn, false);
        }
      });
      // Function to render report data in a specific container
      function renderReport(data, reportContainer, reportContent, reportType) {
        reportContent.innerHTML = "";
        if (data.length === 0) {
          reportContent.innerHTML = `<p class="text-center text-gray-600 p-4">কোন এন্ট্রি পাওয়া যায়নি।</p>`;
          reportContainer.classList.remove("hidden");
          return;
        }
        const table = document.createElement("table");
        table.className =
          "w-full text-left rounded-lg overflow-hidden border-collapse";
        // Determine headers based on report type
        let headers;
        let numColumns;
        if (reportType === "today") {
          headers = ["ব্যবহারকারী", "আজকের খাবার", "পরের দিনের খাবার"];
          numColumns = 3;
        } else {
          // 'meal' report
          headers = ["NameOfB", "Given Taka", "Total Meal", "Enough"];
          numColumns = 4;
        }
        // Table Header
        const thead = document.createElement("thead");
        thead.className = "bg-blue-600 text-white";
        const headerRow = thead.insertRow();
        headers.forEach((headerText) => {
          const th = document.createElement("th");
          th.textContent = headerText;
          th.className = "py-3 px-4 font-semibold";
          headerRow.appendChild(th);
        });
        table.appendChild(thead);
        // Table Body
        const tbody = document.createElement("tbody");
        data.forEach((row, rowIndex) => {
          const tr = tbody.insertRow();
          tr.className = `bg-white border-b border-gray-200 transition-all duration-200 ease-in-out hover:bg-blue-50 hover:shadow-md`;
          for (let i = 0; i < numColumns; i++) {
            const td = tr.insertCell();
            let cellData = row[i];
            td.textContent = cellData;
            td.className = "py-3 px-4 text-gray-800";
          }
        });
        table.appendChild(tbody);
        reportContent.appendChild(table);
        reportContainer.classList.remove("hidden");
      }
      // Fetch today's entries
      todayReportBtn.addEventListener("click", async () => {
        if (!todayReportContainer.classList.contains("hidden")) {
          todayReportContainer.classList.add("hidden");
          showMessage("আজকের এন্ট্রি রিপোর্ট বন্ধ করা হয়েছে।", false);
          return;
        }
        setButtonLoadingState(todayReportBtn, true);
        mealReportContainer.classList.add("hidden"); // Hide other report
        showMessage("আজকের এন্ট্রি লোড হচ্ছে...", false);
        try {
          const response = await fetch(`${SCRIPT_URL}?action=getTodayEntries`);
          const data = await response.json();
          console.log("Today's Report Data:", data); // For debugging
          if (data.status === "success") {
            renderReport(
              data.data,
              todayReportContainer,
              todayReportContent,
              "today"
            );
            showMessage("আজকের এন্ট্রি সফলভাবে লোড হয়েছে।", false);
          } else {
            showMessage(
              "ডেটা লোড করতে ব্যর্থ। অনুগ্রহ করে আবার চেষ্টা করুন।",
              true
            );
            console.error("Data retrieval failed:", data.message);
          }
        } catch (error) {
          showMessage(
            "একটি ত্রুটি ঘটেছে। দয়া করে ইন্টারনেট সংযোগ পরীক্ষা করুন।",
            true
          );
          console.error("Error during data retrieval:", error);
        } finally {
          setButtonLoadingState(todayReportBtn, false);
        }
      });
      // Fetch meal reports
      mealReportBtn.addEventListener("click", async () => {
        if (!mealReportContainer.classList.contains("hidden")) {
          mealReportContainer.classList.add("hidden");
          showMessage("খাবারের রিপোর্ট বন্ধ করা হয়েছে।", false);
          return;
        }
        setButtonLoadingState(mealReportBtn, true);
        todayReportContainer.classList.add("hidden"); // Hide other report
        showMessage("খাবারের রিপোর্ট লোড হচ্ছে...", false);
        try {
          const response = await fetch(`${SCRIPT_URL}?action=getMealReports`);
          const data = await response.json();
          console.log("Meal Report Data:", data); // For debugging
          if (data.status === "success") {
            renderReport(
              data.data,
              mealReportContainer,
              mealReportContent,
              "meal"
            );
            showMessage("খাবারের রিপোর্ট সফলভাবে লোড হয়েছে।", false);
          } else {
            showMessage(
              "ডেটা লোড করতে ব্যর্থ। অনুগ্রহ করে আবার চেষ্টা করুন।",
              true
            );
            console.error("Data retrieval failed:", data.message);
          }
        } catch (error) {
          showMessage(
            "একটি ত্রুটি ঘটেছে। দয়া করে ইন্টারনেট সংযোগ পরীক্ষা করুন।",
            true
          );
          console.error("Error during data retrieval:", error);
        } finally {
          setButtonLoadingState(mealReportBtn, false);
        }
      });
    </script>
  </body>
</html>